These notes are a combination describing the migration of the TURBO ontology to the ODK workflow and the text automatically generated by the ODK seed system. The latter starts with "for the EDITORS of turbo".

## Migration of the TURBO ontology to the ODK workflow

The following steps were taken before copying the contents of the src/ folder to this repo and committing.

 1. Ran ./seed-via-docker.sh with docker on Jan 20, 2022. The project.yaml file used just contained ro, bfo and iao as import group products. This generated the directory tree structure with BFO, IAO, and RO.
 2. The seed turbo-edit.owl was replaced with one based on ontologies/turbo.ttl. That file was loaded into Protege and exported without imports as an RDF/XML owl file. A comment was added to that effect in the ontology. 
 3. Used ODK Makefile version: v1.2.32 (updated to v1.3.0 on Feb. 24, 2022) and ROBOT version 1.8.3 to regenerate the different release artifacts. Inconsistencies were identified with "make all". These were tracked to domain/range constraints of object properties by running ELK in Protege. 'birth instant starts NTR' and 'SNS starts neonate stage' were moved from 'starts'. 'derives from' was replaced with 'is about' for property assertions of 'omop drug_exposure plus vocabulary' and 'omop measurements query result, including vocab and manually asserted mmHg units for BP'.
 4. Edited turbo-odk.yaml to add ogg, geno, htn, osci, pdro, ico, obi, ogms, pato, omrse, ncbitaxon, go, pr, cl, uberon, and mondo. Provided a mirror_from and is_large command for ncbitaxon and pr. Provided gzipped and is_large for chebi. Also added is_large for mondo and go. Provided a mirror for osci since it is non-standard. Made owl the only export format. Ran "sh run.sh make update_repo" to add these. 
 5. Added "use_custom_import_module: TRUE" to use templates/external_import.tsv. Used this to place an ontoneo and so term with just label and parent. Also did this for UO orphan term and added a parent. For EFO, used to add label and parents for 2 orphan term plus one as named individual. Axioms were already there for EFO although for body mass index seems to be different from EFO. 
 6. Edited turbo.makefile to manage imports of selected ontologies. Used templates from makefile as starting point. Compared results using BOT, STAR, and MIREOT and intermediates using refresh. Ended up with:
Used default (BOT) for bfo, iao, ro. These are fundamental and ok with having full representation. Also used default for ogg and geno since these did not add much beyond what was targeted. Populated the terms.txt files based on what's in the released turbo_merged.owl file.
STAR intermediates minimal for obi, omrse, ogms, pdro, osci, htn. Reduced extra classes and largely properly placed in hierarchy.
MIREOT bottom term(s) for mondo, chebi, pr, go, uberon, cl. ico, pato. Pointed to terms.txt files for list of bottom classes (mondo just had one). Dramatically reduced classes to minimal needed but did lead to placement out of hierarchy if ontology did not use bfo for upper level. For NCBITaxon, used MIREOT with both upper and lower terms to specify what's needed and place correctly in hierarchy. 
The terms.txt files were populated based on terms in the released turbo_merged.owl. 
NOTE: previously added pdro and ncbitaxon only through turbo.makefile but currently using update_repo and docker for make. Also previously just used default slme BOT. This led to a total of close to 8000 classes and inconsistencies from the extra classes. Using MIREOT addressed this and STAR helped.  
 7. Updated turbo-edit.owl for direct imports of all owl files in imports.
 8. Ran "sh run.sh make all_main". 
Note: In previous runs, reasoner identified problems with obsolete omrse terms. This was addressed as in https://github.com/PennTURBO/turbo-ontology/issues/13. Also in previous runs just used all_imports and all_main but these did not do all the tests. Also in previous run of all, DL test identified punning issue with use of IAO_0000581:'has time stamp'. Will need to fix later.  
 9. turbo-edit and catalog updated for direct import all refreshed owl imports. 
10. copied src directory in target to replace src contents in GitHub (first in odk-imports branch). Remove large mirrors.

## For the EDITORS of turbo

This project was created using the [ontology development kit](https://github.com/INCATools/ontology-development-kit). See the site for details.

For more details on ontology management, please see the [OBO tutorial](https://github.com/jamesaoverton/obo-tutorial) or the [Gene Ontology Editors Tutorial](https://go-protege-tutorial.readthedocs.io/en/latest/)

You may also want to read the [GO ontology editors guide](http://go-ontology.readthedocs.org/)

## Requirements

 1. Protege (for editing)
 2. A git client (we assume command line git)
 3. [docker](https://www.docker.com/get-docker) (for managing releases)

## Editors Version

Make sure you have an ID range in the [idranges file](turbo-idranges.owl)

If you do not have one, get one from the maintainer of this repo.

The editors version is [turbo-edit.owl](turbo-edit.owl)

** DO NOT EDIT turbo.obo OR turbo.owl in the top level directory **

[../../turbo.owl](../../turbo.owl) is the release version

To edit, open the file in Protege. First make sure you have the repository cloned, see [the GitHub project](https://github.com/PennTURBO/turbo-ontology) for details.

You should discuss the git workflow you should use with the maintainer
of this repo, who should document it here. If you are the maintainer,
you can contact the odk developers for assistance. You may want to
copy the flow an existing project, for example GO: [Gene Ontology
Editors Tutorial](https://go-protege-tutorial.readthedocs.io/en/latest/).

In general, it is bad practice to commit changes to master. It is
better to make changes on a branch, and make Pull Requests.

## ID Ranges

These are stored in the file

 * [turbo-idranges.owl](turbo-idranges.owl)

** ONLY USE IDs WITHIN YOUR RANGE!! **

If you have only just set up this repository, modify the idranges file
	and add yourself or other editors. Note Protege does not read the file
- it is up to you to ensure correct Protege configuration.


### Setting ID ranges in Protege

We aim to put this up on the technical docs for OBO on http://obofoundry.org/

For now, consult the [GO Tutorial on configuring Protege](http://go-protege-tutorial.readthedocs.io/en/latest/Entities.html#new-entities)

## Imports

All import modules are in the [imports/](imports/) folder.

There are two ways to include new classes in an import module

 1. Reference an external ontology class in the edit ontology. In Protege: "add new entity", then paste in the PURL
 2. Add to the imports/ont_terms.txt file, for example imports/go_terms.txt

After doing this, you can run

`./run.sh make all_imports`

to regenerate imports.

Note: the ont_terms.txt file may include 'starter' classes seeded from
the ontology starter kit. It is safe to remove these.

## Release Manager notes

You should only attempt to make a release AFTER the edit version is
committed and pushed, AND the travis build passes.

These instructions assume you have
[docker](https://www.docker.com/get-docker). This folder has a script
[run.sh](run.sh) that wraps docker commands.

to release:

first type

    git branch

to make sure you are on master

    cd src/ontology
    sh run.sh make all

If this looks good type:

    sh run.sh make prepare_release

This generates derived files such as turbo.owl and turbo.obo and places
them in the top level (../..).

Note that the versionIRI value automatically will be added, and will
end with YYYY-MM-DD, as per OBO guidelines.

Commit and push these files.

    git commit -a

And type a brief description of the release in the editor window

Finally type:

    git push origin master

IMMEDIATELY AFTERWARDS (do *not* make further modifications) go here:

 * https://github.com/PennTURBO/turbo-ontology/releases
 * https://github.com/PennTURBO/turbo-ontology/releases/new

__IMPORTANT__: The value of the "Tag version" field MUST be

    vYYYY-MM-DD

The initial lowercase "v" is REQUIRED. The YYYY-MM-DD *must* match
what is in the `owl:versionIRI` of the derived turbo.owl (`data-version` in
turbo.obo). This will be today's date.

This cannot be changed after the fact, be sure to get this right!

Release title should be YYYY-MM-DD, optionally followed by a title (e.g. "january release")

You can also add release notes (this can also be done after the fact). These are in markdown format.
In future we will have better tools for auto-generating release notes.

Then click "publish release"

__IMPORTANT__: NO MORE THAN ONE RELEASE PER DAY.

The PURLs are already configured to pull from github. This means that
BOTH ontology purls and versioned ontology purls will resolve to the
correct ontologies. Try it!

 * http://purl.obolibrary.org/obo/turbo.owl <-- current ontology PURL
 * http://purl.obolibrary.org/obo/turbo/releases/YYYY-MM-DD.owl <-- change to the release you just made

For questions on this contact Chris Mungall or email obo-admin AT obofoundry.org

# Travis Continuous Integration System

Check the build status here: [![Build Status](https://travis-ci.org/PennTURBO/turbo-ontology.svg?branch=master)](https://travis-ci.org/PennTURBO/turbo-ontology)

Note: if you have only just created this project you will need to authorize travis for this repo.

 1. Go to [https://travis-ci.org/profile/PennTURBO](https://travis-ci.org/profile/PennTURBO)
 2. click the "Sync account" button
 3. Click the tick symbol next to turbo-ontology

Travis builds should now be activated